# Writeup 3 - Operational Security and Social Engineering

Name: Kenton Wong
Section: 0201

I pledge on my honor that I have not given or received any unauthorized assistance on this assignment or examniation.

Digital acknowledgement: Kenton Wong

## Assignment Writeup

### Part 1 (40 pts)

Command injection was the key to finding this flag. As long as you know what you are doing, this part should not take that long.

The flag obtained was CMSC389R-{d1gging_f0r_flag5_thr0ugh_1njec7ion}. This was obtained by using command injection after entering the command ‘nc 1337bank.money 1337’ into the command prompt. From here, the user will be prompted to enter a domain or IP to look up. If just the domain or IP of the site is entered then DNS lookup results would appear, giving a series of information about the server. The ‘enter’ key will then be needed to be pressed twice in order to return to the main command prompt.

With this info, it is obvious to tell that command injection would work since one of the pieces of info given by the DNS lookup was “;; global options: +cmd”, which I thought might mean that they are using a command prompt. After typing in the ‘nc’ command, I then tried running ‘; ls’ after the domain/IP prompt. I began the command with a semicolon to simply skip the input prompt part since it would not be needed to be able to run the commands following it (and it saves time). This ended up performing the ‘ls’ command on Moffet’s server, giving me a list of all the directories in the root directory. From here, I could see all the directories inside the server’s root directory. I arbitrarily chose to look into the ‘home’ directory (it seemed most logical to check here first but I also just checked the screenshot in Part 2 that showed that ‘flag.txt’ was in the ‘home’ directory so there’s also that) by entering ‘; cd home; ls’ into the prompt after running the ‘nc’ command, and I was given a list of the files in the ‘home’ directory, which consisted of only the ‘flag.txt’ file. After finding this, I ran the ‘nc’ command again and entered ‘; cd home; cat flag.txt’ into the prompt, and the content of the flag was printed.

A possible fix to this problem would be character whitelisting. This technique allows only certain characters to be accepted by a prompt, which in turn prevents unwanted characters from being accepted. If this is implemented and the semicolon character is not on the whitelist then input would only be taken as input for the prompt, and no other commands would be executed.


### Part 2 (60 pts)

The first thing I did was put an input loop in the main function, looping until “quit” was entered. From there, I could visualize what I wanted the organization of the code to generally look like: the main function taking in all the inputs and calling other functions to validate and execute the commands.

After creating a basic main function, I created another function, ‘valid_cmd’, that would take the raw cmd input and return a macro based on the four commands we are given. “invalid” would be returned for invalid commands. For the ‘pull’ command, a global variable was created to store the ‘remote-path’ and ‘local-path’ arguments. Going in with the mindset of finishing this project in one go, including edge cases, I decided to use regular expressions for validating commands. The regex accounts for leading whitespace, semicolons, and whitespace between arguments. 
Once much progress was made, I decided to split both the ‘valid_cmd’ and ‘execute_cmd’ functions into two parts: one for the outer shell (the one we implement completely) and the inner shell (the one we use via command injection). ‘valid_cmd’ was then split into these two parts with the inner shell checking whether the command is a ‘cd’ or ‘exit’ command or any other command. If the command is a ‘cd’ command, the path is stored in a global variable; if the command is the ‘exit’ command, the inner shell will terminate, leading back to the outer shell.

The ‘execute_cmd’ function also separates inner and outer shell cases. The correct path must be saved in order to perform multiple commands in the correct directory; to deal with this, the paths saved in the global variable will serve to append ‘cd’ commands before the user command.

Other commands are generally explicit in their implementation based on the description.
